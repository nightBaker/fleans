@inherits LayoutComponentBase
@inject Fleans.Web.Services.ThemeService ThemeService
@implements IDisposable

<FluentDesignTheme @bind-Mode="@_mode"
                   @bind-Mode:after="SyncModeToService"
                   @bind-OfficeColor="@_officeColor"
                   @bind-OfficeColor:after="SyncColorToService"
                   StorageName="theme" />

<FluentLayout>
    <FluentHeader>
        <img src="favicon.svg" alt="Fleans logo" style="height: 28px; margin-right: 10px;" />
        Fleans Management
        <FluentSpacer />
    </FluentHeader>

    <FluentStack Orientation="Orientation.Horizontal" Width="100%">
        <NavMenu />

        <FluentBodyContent Style="padding: calc(var(--design-unit) * 1px) 0">
            @Body
        </FluentBodyContent>
    </FluentStack>
</FluentLayout>

<div id="blazor-error-ui" data-nosnippet>
    An unhandled error has occurred.
    <a href="." class="reload">Reload</a>
    <span class="dismiss">ðŸ—™</span>
</div>

@code {
    private DesignThemeModes _mode;
    private OfficeColor? _officeColor;

    protected override void OnInitialized()
    {
        _mode = ThemeService.Mode;
        _officeColor = ThemeService.OfficeColor;
        ThemeService.OnChanged += OnThemeChanged;
    }

    private void OnThemeChanged()
    {
        _mode = ThemeService.Mode;
        _officeColor = ThemeService.OfficeColor;
        InvokeAsync(StateHasChanged);
    }

    private void SyncModeToService()
    {
        ThemeService.Mode = _mode;
    }

    private void SyncColorToService()
    {
        ThemeService.OfficeColor = _officeColor;
    }

    public void Dispose()
    {
        ThemeService.OnChanged -= OnThemeChanged;
    }
}
